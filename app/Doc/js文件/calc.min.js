function WMCMap(){this.elements=new Array();this.size=function(){return this.elements.length};this.isEmpty=function(){return(this.elements.length<1)};this.clear=function(){this.elements=new Array()};this.put=function(b,a){this.remove(b);this.elements.push({key:b,value:a})};this.remove=function(a){var c=false;try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==a){this.elements.splice(i,1);return true}}}catch(b){c=false}return c};this.get=function(a){try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==a){return this.elements[i].value}}}catch(b){return null}};this.element=function(a){if(a<0||a>=this.elements.length){return null}return this.elements[a]};this.containsKey=function(a){var c=false;try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==a){c=true}}}catch(b){c=false}return c};this.containsValue=function(a){var c=false;try{for(i=0;i<this.elements.length;i++){if(this.elements[i].value==a){c=true}}}catch(b){c=false}return c};this.values=function(){var a=new Array();for(i=0;i<this.elements.length;i++){a.push(this.elements[i].value)}return a};this.keys=function(){var a=new Array();for(i=0;i<this.elements.length;i++){a.push(this.elements[i].key)}return a}}Number.prototype.toFixed=function(j){var h=this+"";if(!j){j=0}if(h.indexOf(".")==-1){h+="."}h+=new Array(j+1).join("0");if(new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(j+1)+"})?)\\d*$").test(h)){var h="0"+RegExp.$2,g=RegExp.$1,e=RegExp.$3.length,c=true;if(e==j+2){e=h.match(/\d/g);if(parseInt(e[e.length-1],10)>4){for(var f=e.length-2;f>=0;f--){e[f]=parseInt(e[f],10)+1;if(e[f]==10){e[f]=0;c=f!=1}else{break}}}h=e.join("").replace(new RegExp("(\\d+)(\\d{"+j+"})\\d$"),"$1.$2")}if(c){h=h.substr(1)}return Number((g+h).replace(/\.$/,""))}return Number(this+"")};function accAdd(j,h){var b,a,f,l,c;var g,d;try{g=j.toString().split(".")[1];b=g.length}catch(k){b=0}try{d=h.toString().split(".")[1];a=d.length}catch(k){a=0}f=Math.pow(10,Math.max(b,a));l=j.toString().split(".")[0].toString();if(g){l+=g;if(b<a){l=parseInt(l,10)*Math.pow(10,(a-b))}}else{l=parseInt(l,10)*f}l=parseInt(l,10);c=h.toString().split(".")[0].toString();if(d){c+=d;if(b>a){c=parseInt(c,10)*Math.pow(10,(b-a))}}else{c=parseInt(c,10)*f}c=parseInt(c,10);return(l+c)/f}Number.prototype.add=function(a){return accAdd(a,this)};function accSub(k,j){var c,a,g,b,o,d;var h,f;try{h=k.toString().split(".")[1];c=h.length}catch(l){c=0}try{f=j.toString().split(".")[1];a=f.length}catch(l){a=0}g=Math.pow(10,Math.max(c,a));o=k.toString().split(".")[0].toString();if(h){o+=h;if(c<a){o=parseInt(o,10)*Math.pow(10,(a-c))}}else{o=parseInt(o,10)*g}o=parseInt(o,10);d=j.toString().split(".")[0].toString();if(f){d+=f;if(c>a){d=parseInt(d,10)*Math.pow(10,(c-a))}}else{d=parseInt(d,10)*g}d=parseInt(d,10);return(o-d)/g}Number.prototype.sub=function(a){return accSub(this,a)};function accMul(d,b){var a=0,f=d.toString(),c=b.toString();try{a+=f.split(".")[1].length}catch(g){}try{a+=c.split(".")[1].length}catch(g){}return(Number(f.replace(".",""))*Number(c.replace(".",""))/Math.pow(10,a))}Number.prototype.mul=function(a){return accMul(a,this)};function accDiv(arg1,arg2){var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math){r1=Number(arg1.toString().replace(".",""));r2=Number(arg2.toString().replace(".",""));return((r1/r2)*pow(10,t2-t1))}}Number.prototype.div=function(a){return accDiv(this,a)};PROMOTION_TYPE_AMT=0;PROMOTION_TYPE_PCT=1;PROMOTION_TYPE_AMT_TIERED=2;PROMOTION_TYPE_PCT_TIERED=3;PROMOTION_TYPE_FIXED=4;PROMOTION_TYPE_AMT_ONLINE=6;PROMOTION_TYPE_AMT_ONLINE_TIERED=106;function calcDiscount(a){var g=0;if(a&&a.length>0){var c=getMapCartItem(a);if(c.size()>0){var e;var d;var f=c.elements;for(var b=0;b<f.length;b++){e=getOfferById(f[b].key);if(e){d=f[b].value;switch(e.gpCaclTypeCode){case PROMOTION_TYPE_AMT:g=g.add(calcDiscountTypeAMT(e,d));break;case PROMOTION_TYPE_PCT:g=g.add(calcDiscountTypePCT(e,d));break;case PROMOTION_TYPE_FIXED:g=g.add(calcDiscountTypeFixed(e,d));break;case PROMOTION_TYPE_AMT_TIERED:g=g.add(calcDiscountTypeAMTTiered(e,d));break;case PROMOTION_TYPE_PCT_TIERED:g=g.add(calcDiscountTypePCTTiered(e,d));break;case PROMOTION_TYPE_AMT_ONLINE:g=g.add(calcDiscountTypeAMTOnline(e,d));break;case PROMOTION_TYPE_AMT_ONLINE_TIERED:g=g.add(calcDiscountTypeAMTOnlineTiered(e,d));break;default:break}}}}}return g}function getOfferById(b){var d;for(var c=0;c<data.length;c++){d=data[c];if(b==d.gpOfferId){var a=d.groups;a.sort(function(f,e){var g=parseInt(e.groupSeq,10)-parseInt(f.groupSeq,10);return g});d.groups=a;return d}}return}function getMapCartItem(a){var f=new WMCMap();var d;var c;var e;for(var b=0;b<a.length;b++){c=a[b];if(c.offerId||c.offerId==0){if(f.containsKey(c.offerId)){d=f.get(c.offerId);if(d.containsKey(c.groupId)){e=d.get(c.groupId);e.push(c);d.put(c.groupId,e)}else{e=new Array();e.push(c);d.put(c.groupId,e)}f.put(c.offerId,d)}else{d=new WMCMap();e=new Array();e.push(c);d.put(c.groupId,e);f.put(c.offerId,d)}}}return f}function calcDiscountTypeAMT(j,f){var p=0;var d=0;var c=j.groups;var b=0;var a=999999999;var m;var l;var h;var o;for(var g=0;g<c.length;g++){l=c[g];if(l){m=l.groupSeq;h=f.get(m);var n=0;if(h){for(var e=0;e<h.length;e++){o=h[e];n+=o.qty;d=d.add(o.qty.mul(o.taxPrice)).toFixed(2)}}b=parseInt(n.div(l.thresholdQty),10);if(b<a){a=b}p=a.mul(j.discountFactor).toFixed(2);if(p>=d){p=0}}}return p}function calcDiscountTypeAMTOnline(l,f){var p=0;var d=0;var c=l.groups;var b=0;var a=999999999;var n;var m;var h;var o;var j=l.discountTimes;for(var g=0;g<c.length;g++){m=c[g];if(m){n=m.groupSeq;h=f.get(n);if(h){for(var e=0;e<h.length;e++){o=h[e];d=d.add(o.qty.mul(o.taxPrice)).toFixed(2)}}b=parseInt(d.div(m.thresholdAmt),10);if(j==0){a=b}else{if(j>b){a=b}else{a=j}}p=a.mul(l.discountFactor).toFixed(2);if(p>=d){p=0}}}return p}function calcDiscountTypePCT(h,d){var l=0;if(h&&d.size()>0){if(h.groups.length>1){return}var g=false;var c=0;var a=d.keys()[0];var f=d.get(a);var m=0;var k;for(var e=0;e<f.length;e++){k=f[e];m+=k.qty;c=c.add(k.qty.mul(k.taxPrice)).toFixed(2)}var b=h.groups;if(b&&b.length!=0){var j=b[0];g=m>=j.thresholdQty}if(g){l=c.mul(h.discountFactor).div(100).toFixed(2)}if(l>=c){l=0}}return l}function calcDiscountTypeFixed(l,f){var o=0;if(l&&f.size()>0){if(l.groups.length>1){return}var b=f.keys()[0];var k=f.get(b);k.sort(function(q,p){return p.taxPrice-q.taxPrice});var g=0;for(var h=0;h<k.length;h++){g+=k[h].qty}var e=l.groups;var m;if(e&&e.length!=0){m=e[0]}var a=0;var c;if(m){a=parseInt(g/m.thresholdQty,10);c=a*m.thresholdQty}var d=0;var n;for(var h=0;h<k.length;h++){n=k[h];if(c>=n.qty){d=d.add(n.qty.mul(n.taxPrice)).toFixed(2);c-=n.qty}else{d=d.add(c.mul(n.taxPrice)).toFixed(2);break}}var j=a.mul(l.discountFactor);if(d>j){o=d.sub(j).toFixed(2)}if(o>=d){o=0}}return o}function calcDiscountTypeAMTTiered(l,e){var p=0;if(l&&e.size()>0){var g=0;var c=l.groups;var m;var a;var h;var o;for(var f=0;f<c.length;f++){m=c[f];a=m.groupSeq;h=e.get(a);var n=0;if(h){for(var d=0;d<h.length;d++){o=h[d];n+=o.qty;g=g.add(o.qty.mul(o.taxPrice)).toFixed(2)}}var r=m.tieredDiscount;r.sort(function(s,k){return k.thresholdQty-s.thresholdQty});var q;for(var j=0;j<r.length;j++){q=r[j];if(n>=q.thresholdQty){var b=q.discountFactor;p=p.add(b).toFixed(2);break}}}if(p>=g){p=0}}return p}function calcDiscountTypeAMTOnlineTiered(l,e){var o=0;if(l&&e.size()>0){var g=0;var c=l.groups;var m;var a;var h;var n;for(var f=0;f<c.length;f++){m=c[f];a=m.groupSeq;h=e.get(a);if(h){for(var d=0;d<h.length;d++){n=h[d];g=g.add(n.qty.mul(n.taxPrice)).toFixed(2)}}var q=m.tieredDiscount;q.sort(function(r,k){return k.thresholdAmt-r.thresholdAmt});var p;for(var j=0;j<q.length;j++){p=q[j];if(g>=p.thresholdAmt){var b=p.discountFactor;o=o.add(b).toFixed(2);break}}}if(o>=g){o=0}}return o}function calcDiscountTypePCTTiered(l,d){var p=0;if(l&&d.size()>0){var b=l.groups;var m;var a;var g;var q;var f=0;for(var e=0;e<b.length;e++){m=b[e];if(m){a=m.groupSeq;g=d.get(a);var o=0;var j=0;if(g){for(var c=0;c<g.length;c++){q=g[c];o+=q.qty;j=j.add(q.qty.mul(q.taxPrice)).toFixed(2)}}f=f.add(j).toFixed(2);var s=m.tieredDiscount;s.sort(function(t,k){return k.thresholdQty-t.thresholdQty});var n=0;var r;for(var h=0;h<s.length;h++){r=s[h];if(o>=r.thresholdQty){n=r.discountFactor;break}}p=p.add(j).mul(n).div(100).toFixed(2)}}if(p>=f){p=0}}return p}var RECOMMEND_AMT=1;var RECOMMEND_PCT=20;function contains(c,b){var a=c.length;while(a--){if(c[a].productId===b.productId&&c[a].offerId===b.offerId){return true}}return false}function calculateInItemLevel(e){var j=new Array();for(var f=0;f<e.length;f++){var h=e[f];if(h.qty>0){j.push(h)}}var n=new Array();if(j!=null&&j.length>0){var b=getMapCartItem(j);if(b.size()>0){var l;var c;var a=b.elements;for(var f=0;f<a.length;f++){l=getOfferById(a[f].key);var g;if(l){c=a[f].value;switch(l.gpCaclTypeCode){case PROMOTION_TYPE_AMT:g=calculateInItemLevelTypeAMT(l,c);break;case PROMOTION_TYPE_PCT:g=calculateInItemLevelTypePCT(l,c);break;case PROMOTION_TYPE_FIXED:g=calculateInItemLevelTypeFixed(l,c);break;case PROMOTION_TYPE_AMT_TIERED:g=calculateInItemLevelTypeAMTTiered(l,c);break;case PROMOTION_TYPE_PCT_TIERED:g=calculateInItemLevelTypePCTTiered(l,c);break;case PROMOTION_TYPE_AMT_ONLINE:g=calculateInItemLevelTypeAMTOnline(l,c);break;case PROMOTION_TYPE_AMT_ONLINE_TIERED:g=calculateInItemLevelTypeAMTOnlineTiered(l,c);break;default:break}if(g!=null){for(var d=0;d<g.length;d++){var m=g[d];n.push(m)}}}}}}return n}function calculateInItemLevelTypeAMTTiered(l,d){var n=new Array();var q=0;if(l!=null&&d.size()>0){var g=0;var b=l.groups;var m;var a;var h;var p;for(var f=0;f<b.length;f++){m=b[f];a=m.groupSeq;h=d.get(a);var o=0;if(h){for(var c=0;c<h.length;c++){p=h[c];o+=p.qty;g=g.add(p.qty.mul(p.taxPrice));n.push(p)}}var r=m.tieredDiscount;r.sort(function(k,j){return j.thresholdQty-k.thresholdQty});for(var e=0;e<r.length;e++){if(o>=r[e].thresholdQty){q=q.add(r[e].discountFactor);break}}}if(q>=g){q=0}for(var f=0;f<n.length;f++){var p=n[f];p.taxPrice=p.qty.mul(p.taxPrice).mul(q).div(g).toFixed(2);if(!p.taxPrice){p.taxPrice=0}p.qty=0;n[f]=p}}return n}function calculateInItemLevelTypeAMTOnlineTiered(l,d){var n=new Array();var p=0;if(l!=null&&d.size()>0){var g=0;var b=l.groups;var m;var a;var h;var o;for(var f=0;f<b.length;f++){m=b[f];a=m.groupSeq;h=d.get(a);if(h){for(var c=0;c<h.length;c++){o=h[c];g=g.add(o.qty.mul(o.taxPrice));n.push(o)}}var q=m.tieredDiscount;q.sort(function(k,j){return j.thresholdQty-k.thresholdQty});for(var e=0;e<q.length;e++){if(g>=q[e].thresholdQty){p=p.add(q[e].discountFactor);break}}}if(p>=g){p=0}for(var f=0;f<n.length;f++){var o=n[f];o.taxPrice=o.qty.mul(o.taxPrice).mul(p).div(g).toFixed(2);if(!o.taxPrice){o.taxPrice=0}o.qty=0;n[f]=o}}return n}function calculateInItemLevelTypeAMT(j,f){var n=new Array();var q=0;var d=0;var c=j.groups;var b=0;var a=99999999;var m;var l;var h;var p;for(var g=0;g<c.length;g++){l=c[g];if(l){m=l.groupSeq;h=f.get(m);var o=0;if(h){for(var e=0;e<h.length;e++){p=h[e];o+=p.qty;d=d.add(p.qty.mul(p.taxPrice));n.push(p)}}b=parseInt(o.div(l.thresholdQty),10);if(b<a){a=b}}}q=a.mul(j.discountFactor);if(q>=d){q=0}for(var g=0;g<n.length;g++){var p=n[g];p.taxPrice=p.qty.mul(p.taxPrice).mul(q).div(d).toFixed(2);if(!p.taxPrice){p.taxPrice=0}p.qty=0;n[g]=p}return n}function calculateInItemLevelTypeAMTOnline(l,f){var o=new Array();var q=0;var d=0;var c=l.groups;var b=0;var a=99999999;var n;var m;var h;var p;var j=l.discountTimes;for(var g=0;g<c.length;g++){m=c[g];if(m){n=m.groupSeq;h=f.get(n);if(h){for(var e=0;e<h.length;e++){p=h[e];d=d.add(p.qty.mul(p.taxPrice));o.push(p)}}b=parseInt(d.div(m.thresholdAmt),10);if(j==0){a=b}else{if(j>b){a=b}else{a=j}}}}q=a.mul(l.discountFactor);if(q>=d){q=0}for(var g=0;g<o.length;g++){var p=o[g];p.taxPrice=p.qty.mul(p.taxPrice).mul(q).div(d).toFixed(2);if(!p.taxPrice){p.taxPrice=0}p.qty=0;o[g]=p}return o}function calculateInItemLevelTypePCTTiered(m,d){var o=new Array();var s=0;if(m&&d.size()>0){var b=m.groups;var n;var a;var h;var r;var g=0;for(var f=0;f<b.length;f++){n=b[f];if(n){a=n.groupSeq;h=d.get(a);var q=0;var l=0;if(h){for(var c=0;c<h.length;c++){r=h[c];q+=r.qty;l=l.add(r.qty.mul(r.taxPrice));o.push(r)}}g=g.add(l);var t=n&&n.tieredDiscount;t.sort(function(k,j){return j.thresholdQty-k.thresholdQty});var p=0;for(var e=0;e<t.length;e++){if(q>=t[e].thresholdQty){p=t[e].discountFactor;break}}s=s.add(l).mul(p).div(100).toFixed(2)}}if(s>=g){s=0}for(var f=0;f<o.length;f++){var r=o[f];r.taxPrice=r.qty.mul(r.taxPrice).mul(s).div(g).toFixed(2);if(!r.taxPrice){r.taxPrice=0}r.qty=0;o[f]=r}}return o}function calculateInItemLevelTypePCT(g,c){var m=0;var h=new Array();if(g!=null&&c.size()>0){if(g.groups.length>1){return}var f=false;var b=0;var a=c.keys()[0];var e=c.get(a);var l=0;var k;for(var d=0;d<e.length;d++){k=e[d];l+=k.qty;b=b.add(k.qty.mul(k.taxPrice));h.push(k)}if(a==g.groups[0].groupSeq){var j=g.groups[0];f=l>=j.thresholdQty}if(f){m=b.mul(g.discountFactor).div(100).toFixed(2)}if(m>=b){m=0}for(var d=0;d<h.length;d++){var k=h[d];k.taxPrice=k.qty.mul(k.taxPrice).mul(m).div(b).toFixed(2);if(!k.taxPrice){k.taxPrice=0}k.qty=0;h[d]=k}return h}}function calculateInItemLevelTypeFixed(m,f){var r=0;var p=new Array();if(m!=null&&f.size()>0){if(m.groups.length>1){return}var b=f.keys()[0];var l=f.get(b);l.sort(function(t,s){return s.taxPrice-t.taxPrice});var g=0;var e=0;for(var h=0;h<l.length;h++){e=e.add(l[h].qty.mul(l[h].taxPrice));g+=l[h].qty;p.push(l[h])}var d=m.groups;var n;for(var h=0;h<d.length;h++){var o=d[h];if(o.groupSeq==b){n=o}}var a=0;var c=0;if(n!=null){a=parseInt(g/n.thresholdQty,10);c=a*n.thresholdQty}var j=0;for(var h=0;h<l.length;h++){q=l[h];if(c>=q.qty){j=j.add(q.qty.mul(q.taxPrice));c-=q.qty}else{j=j.add(c.mul(q.taxPrice));break}}var k=a.mul(m.discountFactor);if(j>k){r=j.sub(k)}if(r>=e){r=0}for(var h=0;h<p.length;h++){var q=p[h];q.taxPrice=q.qty.mul(q.taxPrice).mul(r).div(e).toFixed(2);if(!q.taxPrice){q.taxPrice=0}q.qty=0;p[h]=q}return p}}function objToJSON(e){var b="{";var c;for(var d in e){c=e[d];if(c!="undefined"&&(typeof c!="function")){if(typeof c=="object"){if(c.length&&(c.length>0)){b+='"'+d+'":[';for(var a=0;a<c.length;a++){b+=objToJSON(c[a])+","}b=b.substring(0,b.length-1);b+="],"}else{if(c.length==0){b+='"'+d+'":[],'}else{b+=objToJSON(c)}}}else{b+='"'+d+'":'+c+","}}}b=b.substring(0,b.length-1);b+="}";return b}function JSONToString(c){var b;if(c.length&&(c.length>0)){b="[";for(var a=0;a<c.length;a++){b+=objToJSON(c[a])+","}b=b.substring(0,b.length-1);b+="]"}else{if(c.length==0){return"[]"}else{b=objToJSON(c)}}return b}function getPromotionInfo(cartItems){CAL_STRING="cal";cartItems=eval("("+cartItems+")");var resultArray=new Array();var obj;var cartItem;for(var i=0;i<cartItems.length;i++){cartItem=cartItems[i];if(cartItem.length>0){obj=new Object();obj.offerId=cartItem[0].offerId;var offer=getOfferById(obj.offerId);var cartMaps=getMapCartItem(cartItem);var groupMaps=cartMaps.values()[0];var desc=isRemind(offer,groupMaps);if(!desc){obj.tips='""';obj.totalDiscount=0;obj.items=[]}else{var totalDiscount=0;if(desc!=CAL_STRING){obj.tips='"'+desc+'"'}else{obj.tips='""';totalDiscount=calcDiscount(cartItem)}obj.totalDiscount=totalDiscount;var items=calculateInItemLevel(cartItem);items=balancePriceForItems(totalDiscount,items);obj.items=items}obj.offerDesc='""';if(offer&&offer.promotionDescCn){obj.offerDesc='"'+offer.promotionDescCn+'."'}resultArray.push(obj)}}return JSONToString(resultArray)}function balancePriceForItems(b,c){if(c.length>0){if(c[0].productId!=null&&c[0].items!=""&&c[0].productId!=undefined){c.sort(function(k,j){return k.productId-j.productId})}else{c.sort(function(k,j){return k.upc-j.upc})}var e=0;for(var d=0;d<c.length;d++){e=e.add(c[d].taxPrice)}if(b!=e){var g=b.sub(e);var f=parseInt(Math.abs(g)*100/c.length,10);var h=Math.abs(g)*100%c.length;var a=g/Math.abs(g);for(var d=0;d<c.length;d++){c[d].taxPrice=c[d].taxPrice.add(f.mul(0.01).mul(a));if(h>d){c[d].taxPrice=c[d].taxPrice.add(0.01.mul(a))}}}}return c}function balancePriceForItemsV2(b,c){c.sort(function(k,j){return k.productId-j.productId});var e=0;for(var d=0;d<c.length;d++){e=e.add(c[d].taxPrice)}if(b!=e){var g=b.sub(e);var f=parseInt(Math.abs(g)*100/c.length,10);var h=Math.abs(g)*100%c.length;var a=g/Math.abs(g);for(var d=0;d<c.length;d++){c[d].taxPrice=c[d].taxPrice.add(f.mul(0.01).mul(a));if(h>d){c[d].taxPrice=c[d].taxPrice.add(0.01.mul(a))}}}return c}function isRemind(b,d){var v;var e=0;var g=0;var k=b&&b.groups;var h;var j;var r;var o;var n;var s=new Array();if(!k){return false}for(var q=0;q<k.length;q++){h=k[q];g=h.thresholdQty;j=h.groupSeq;n=h.thresholdAmt;o=h.tieredDiscount;r=d.get(j);if(!r){break}var f=0;var l=0;var a=0;for(var t=0;t<r.length;t++){l=r[t].qty;a=(a+r[t].taxPrice*l).toFixed(2);f+=r[t].qty}var m=new Object();m.relQty=f;m.minQty=g;m.thresholdAmt=n;m.tieredDiscount=o;m.relTaxPrice=a;s.push(m);e++}var m=s[0];if(b.gpCaclTypeCode==PROMOTION_TYPE_AMT||b.gpCaclTypeCode==PROMOTION_TYPE_AMT_ONLINE){v=CAL_STRING;if(k.length==1){if(e==1){if(b.gpCaclTypeCode==PROMOTION_TYPE_AMT){if(g>m.relQty){v="您已购买"+m.relQty+"件，再购买"+(g-m.relQty)+"件就可以享受"+(b.discountFactor).toFixed(2)+"元的优惠"}}else{if(n>m.relTaxPrice){v="您已购买"+(m.relTaxPrice).toFixed(2)+"元，再购买"+(n-m.relTaxPrice).toFixed(2)+"元就可以享受"+(b.discountFactor).toFixed(2)+"元的优惠"}}}}}else{if(b.gpCaclTypeCode==PROMOTION_TYPE_PCT){if(m.relQty<g){v="您已购买"+m.relQty+"件，再购买"+(m.minQty-m.relQty)+"件就可以享受"+(100-b.discountFactor).div(10)+"折的优惠"}else{v=CAL_STRING}}else{if(b.gpCaclTypeCode==PROMOTION_TYPE_AMT_TIERED||b.gpCaclTypeCode==PROMOTION_TYPE_PCT_TIERED||b.gpCaclTypeCode==PROMOTION_TYPE_AMT_ONLINE_TIERED){var o=m.tieredDiscount;o.sort(function(w,p){return w.thresholdQty-p.thresholdQty});var g=0;var f=m.relQty;var a=m.relTaxPrice;var c;var u=-1;for(var t=0;t<o.length;t++){u=t;if(f<=o[t].thresholdQty){g=o[t].thresholdQty;c=o[t].discountFactor;break}}if(b.gpCaclTypeCode==PROMOTION_TYPE_AMT_ONLINE_TIERED){if(g>m.relTaxPrice&&u==0){v="您已购买"+(m.relTaxPrice).toFixed(2)+"元，再购买"+(g-m.relTaxPrice).toFixed(2)+"元就可以享受"+c.toFixed(2)+"元的优惠"}else{v=CAL_STRING}}else{if(g>m.relQty&&u==0){if(b.gpCaclTypeCode==PROMOTION_TYPE_AMT_TIERED){v="您已购买"+m.relQty+"件，再购买"+(g-m.relQty)+"件就可以享受"+c.toFixed(2)+"元的优惠"}else{v="您已购买"+m.relQty+"件，再购买"+(g-m.relQty)+"件就可以享受"+(100-c).div(10)+"折的优惠"}}else{v=CAL_STRING}}}else{if(b.gpCaclTypeCode==PROMOTION_TYPE_FIXED){if(m.minQty>m.relQty){v="您已购买"+m.relQty+"件，再购买"+(m.minQty-m.relQty)+"件就可以享受总价格"+(b.discountFactor).toFixed(2)+"元"}else{v=CAL_STRING}}}}}return v}function getPromotionInfoForAndroid(a){window.javaKey.onDiscountBack(getPromotionInfo(a))};